@model ASP.NET_MVC_MajsterStrelby.Models.GameWordsModel
@{
    ViewBag.Title = "Game";
    //Calculate time which depends on thirth skill - Stamina and base component - 60 seconds
    var endTime = DateTime.UtcNow.AddSeconds((Model._actualPlayer._skills[2] - 1) * 5 + 60);
    var timeRemaining = TimeSpan.FromTicks(endTime.Ticks - DateTime.UtcNow.Ticks).TotalSeconds;
    //Calculate number of attempts which player have which dpends on first skill - Power and base component - 3 attempts
    var numberOfShots = 3 + (Model._actualPlayer._skills[0] / 2);
    //Fill the random chance to create random character to positions
    int[] characterForPossibleWords = new int[Model._possibleWords.Count];
    Random rnd = new Random();
    for (int i = 0; i < Model._possibleWords.Count; i++)
    {
        characterForPossibleWords[i] = rnd.Next(1, 6);
    }
    char counter = 'A';
}

<div class="div_absolute">
    <h2 id="taskWord" class="text-center">@Model._taskWord</h2>
    <h4 id="remainingSeconds" class="text-center">@timeRemaining</h4>
    <h4 id="remainingArrows" class="text-center">@numberOfShots</h4>
    <button type="button" class="btn btn-secondary btn-lg centerButton" onclick="return sendData()">Odoslať odpoveď</button>
</div>

@using (Html.BeginForm("SendData", "Game", FormMethod.Post))
{
<div class="options">

    @foreach (var possibleWord in Model._possibleWords)
    {

        switch (characterForPossibleWords[counter - 'A'])
        {
            case 1:
                <div class="@(counter++)option">
                    <img src="~/Images/Game/Giraffe_edit.png" class="giraffe">
                    <button type="button" class="btn btn-secondary btn-giraffe" onclick="return onClickDisabled.call(this);" value=@possibleWord>@possibleWord</button>
                </div>
                break;

            case 2:
                <div class="@(counter++)option">
                    <img src="~/Images/Game/Kangaroo_edit.png" class="kangaroo">
                    <button type="button" class="btn btn-secondary btn-kangaroo" onclick="return onClickDisabled.call(this);" value=@possibleWord>@possibleWord</button>
                </div>
                break;

            case 3:
                <div class="@(counter++)option">
                    <img src="~/Images/Game/BrownBear_edit.png" class="brownbear">
                    <button type="button" class="btn btn-secondary btn-brownbear" onclick="return onClickDisabled.call(this);" value=@possibleWord>@possibleWord</button>
                </div>
                break;

            case 4:
                <div class="@(counter++)option">
                    <img src="~/Images/Game/Goat_edit.png" class="goat">
                    <button type="button" class="btn btn-secondary btn-goat" onclick="return onClickDisabled.call(this);" value=@possibleWord>@possibleWord</button>
                </div>
                break;

            case 5:
                <div class="@(counter++)option">
                    <img src="~/Images/Game/Monkey_edit.png" class="monkey">
                    <button type="button" class="btn btn-secondary btn-monkey" onclick="return onClickDisabled.call(this);" value=@possibleWord>@possibleWord</button>
                </div>
                break;
        }
    }

</div>

<script>
    //var taskword = document.getElementById('taskWord');
    var words = [];
    var model = @Html.Raw(Json.Encode(Model));
    var counter = 0;
    var secRemaining = @timeRemaining;
    var arrowsRemaining = @numberOfShots;

    function startTick() {
        var _ticks = setInterval(function () {
            if (secRemaining > 0) {
                secRemaining -= 1;
                document.getElementById('remainingSeconds').innerText = secRemaining;
            }
            else {
                sendData();
                clearInterval(_tick);
            }
        }, 1000);
    }
    startTick();


    function onClickDisabled() {
        if (arrowsRemaining > 0) {
            arrowsRemaining -= 1;
            document.getElementById('remainingArrows').innerText = arrowsRemaining;
            this.disabled = 'true';
            console.log(this);
            console.log(words);
            words[counter++] = this.value;
            return true;
        }
        else
            alert("Už niesu ďalšie śípy");

    }

    function sendData() {
        $.ajax({
        contentType: 'application/json',
            dataType: 'json',
            type: 'POST',
            url: "@Url.Action("SendData","Game")",
            data: JSON.stringify({
            choosenWords: words,
                model: model
            }),
            success: function (response) {
                //alert(response.Success);
                //alert(response.Message);
                console.log(response);
                window.location.href = '@Url.Action("Result", "Game")/' + response.Message;
            },
            failure: function (response) {
                alert(response.failure);
                //alert(response.Message);
                console.log(response);
            }
        });

        return true;
    }
            </script>
        }

